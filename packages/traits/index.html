
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.4. Traits: building interactive dialogs &#8212; Scipy lecture notes</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2018.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.5. 3D plotting with Mayavi" href="../3d_plotting/index.html" />
    <link rel="prev" title="3.3.9.11. Watershed and random walker for segmentation" href="../scikit-image/auto_examples/plot_segmentations.html" />
   
    <link rel="stylesheet"
	  href="https://unpkg.com/purecss@1.0.0/build/base-min.css">

<script type="text/javascript">
$(function () {
    // Highlight the table of content as we scroll
    sections = {},
    i        = 0,
    url	 = document.URL.replace(/#.*$/, ""),
    current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();

	// Highlight the current section
	$('a.internal').parent().removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().parent().parent().addClass('active');
    });

});
</script>


  </head>
  <body>
   <!-- Use the header to add javascript -->
    

    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();

		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../3d_plotting/index.html" title="3.5. 3D plotting with Mayavi"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../scikit-image/auto_examples/plot_segmentations.html" title="3.3.9.11. Watershed and random walker for segmentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">3. Packages and applications</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/scipy-lectures/scipy-lecture-notes/edit/master/packages/traits/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Edit it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="traits-building-interactive-dialogs">
<span id="traits"></span><h1>3.4. Traits: building interactive dialogs<a class="headerlink" href="#traits-building-interactive-dialogs" title="Permalink to this headline">¶</a></h1>
<p><strong>Author</strong>: <em>Didrik Pinte</em></p>
<p>The Traits project allows you to simply add validation, initialization, delegation, notification and a graphical user interface to Python object attributes.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In this tutorial we will explore the Traits toolset and learn how to
dramatically reduce the amount of boilerplate code you write, do
rapid GUI application development, and understand the ideas which
underly other parts of the Enthought Tool Suite.</p>
<p class="last">Traits and the Enthought Tool Suite are open source projects licensed
under a BSD-style license.</p>
</div>
<div class="topic">
<p class="topic-title first">Intended Audience</p>
<p>Intermediate to advanced Python programmers</p>
</div>
<div class="topic">
<p class="topic-title first">Requirements</p>
<ul class="simple">
<li>Either <a class="reference external" href="http://www.wxpython.org">wxPython</a>,
<a class="reference external" href="https://riverbankcomputing.com/software/pyqt/intro">PyQt</a> or
<a class="reference external" href="https://pyside.github.io/docs/pyside/">PySide</a></li>
<li>Numpy and Scipy</li>
<li><a class="reference external" href="http://code.enthought.com/projects">Enthought Tool Suite</a></li>
<li>All required software can be obtained by installing the <a class="reference external" href="https://store.enthought.com/">EPD Free</a></li>
</ul>
</div>
<div class="contents local topic" id="tutorial-content">
<p class="topic-title first">Tutorial content</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#example" id="id2">Example</a></li>
<li><a class="reference internal" href="#what-are-traits" id="id3">What are Traits</a><ul>
<li><a class="reference internal" href="#initialisation" id="id4">Initialisation</a></li>
<li><a class="reference internal" href="#validation" id="id5">Validation</a></li>
<li><a class="reference internal" href="#documentation" id="id6">Documentation</a></li>
<li><a class="reference internal" href="#visualization-opening-a-dialog" id="id7">Visualization: opening a dialog</a></li>
<li><a class="reference internal" href="#deferral" id="id8">Deferral</a></li>
<li><a class="reference internal" href="#notification" id="id9">Notification</a></li>
<li><a class="reference internal" href="#some-more-advanced-traits" id="id10">Some more advanced traits</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">3.4.1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The Enthought Tool Suite enable the construction of sophisticated
application frameworks for data analysis, 2D plotting and 3D
visualization. These powerful, reusable components are released under
liberal BSD-style licenses.</p>
<img alt="../../_images/ETS.jpg" class="last align-right" src="../../_images/ETS.jpg" />
</div>
<p>The main packages of the Enthought Tool Suite are:</p>
<blockquote>
<div><ul class="simple">
<li>Traits - component based approach to build our applications.</li>
<li>Kiva - 2D primitives supporting path based rendering, affine transforms,
alpha blending and more.</li>
<li>Enable - object based 2D drawing canvas.</li>
<li>Chaco - plotting toolkit for building complex interactive 2D plots.</li>
<li>Mayavi - 3D visualization of scientific data based on VTK.</li>
<li>Envisage - application plugin framework for building scriptable and
extensible applications</li>
</ul>
</div></blockquote>
<p>In this tutorial, we will focus on Traits.</p>
</div>
<div class="section" id="example">
<h2><a class="toc-backref" href="#id2">3.4.2. Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Throughout this tutorial, we will use an example based on a water resource
management simple case. We will try to model a dam and reservoir system. The
reservoir and the dams do have a set of parameters :</p>
<blockquote>
<div><ul class="simple">
<li>Name</li>
<li>Minimal and maximal capacity of the reservoir [hm3]</li>
<li>Height and length of the dam [m]</li>
<li>Catchment area [km2]</li>
<li>Hydraulic head [m]</li>
<li>Power of the turbines [MW]</li>
<li>Minimal and maximal release [m3/s]</li>
<li>Efficiency of the turbines</li>
</ul>
</div></blockquote>
<p>The reservoir has a known behaviour. One part is related to the energy
production based on the water released. A simple formula for
approximating electric power production at a hydroelectric plant is
<img class="math" src="../../_images/math/924380d1f45ea2eb29bb8c4ec3877e2dddc182ad.png" alt="P = \rho hrgk"/>, where:</p>
<blockquote>
<div><ul class="simple">
<li><img class="math" src="../../_images/math/9dcbbef8e0f76051d388013b90a95bec3069e484.png" alt="P"/> is Power in watts,</li>
<li><img class="math" src="../../_images/math/9a51ab9a0b521705e1e8762fac6bdd6f11771758.png" alt="\rho"/> is the density of water (~1000 kg/m3),</li>
<li><img class="math" src="../../_images/math/293fb39e1b93282c804a86186e721b32f829f1b2.png" alt="h"/> is height in meters,</li>
<li><img class="math" src="../../_images/math/eaa6ad49a7f78fe5a13b486690163bf2dc7e3e60.png" alt="r"/> is flow rate in cubic meters per second,</li>
<li><img class="math" src="../../_images/math/307b3725cbb03398131f9ca542d79aff4933195f.png" alt="g"/> is acceleration due to gravity of 9.8 m/s2,</li>
<li><img class="math" src="../../_images/math/0b7c1e16a3a8a849bb8ffdcdbf86f65fd1f30438.png" alt="k"/> is a coefficient of efficiency ranging from 0 to 1.</li>
</ul>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Annual electric energy production depends on the available water supply.
In some installations the water flow rate can vary by a factor of 10:1
over the course of a year.</p>
</div>
<p>The second part of the behaviour is the state of the storage that depends
on controlled and uncontrolled parameters :</p>
<blockquote>
<div><img class="math" src="../../_images/math/5ebb483ac72ea41b5cff6fd2ffd62b4cbce80861.png" alt="storage_{t+1} = storage_t + inflows - release - spillage - irrigation"/></div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The data used in this tutorial are not real and might even not have sense
in the reality.</p>
</div>
</div>
<div class="section" id="what-are-traits">
<h2><a class="toc-backref" href="#id3">3.4.3. What are Traits</a><a class="headerlink" href="#what-are-traits" title="Permalink to this headline">¶</a></h2>
<p>A trait is a type definition that can be used for normal Python object
attributes, giving the attributes some additional characteristics:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Standardization:</dt>
<dd><ul class="first last">
<li>Initialization</li>
<li>Validation</li>
<li>Deferral</li>
</ul>
</dd>
</dl>
</li>
<li>Notification</li>
<li>Visualization</li>
<li>Documentation</li>
</ul>
</div></blockquote>
<p>A class can freely mix trait-based attributes with normal Python
attributes, or can opt to allow the use of only a fixed or open set of
trait attributes within the class. Trait attributes defined by a class
are automatically inherited by any subclass derived from the class.</p>
<p>The common way of creating a traits class is by extending from the
<strong>HasTraits</strong> base class and defining class traits :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span> <span class="n">Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="k">class</span> <span class="nc">Reservoir</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">name</span> <span class="o">=</span> <span class="n">Str</span>
<div class="newline"></div>    <span class="n">max_storage</span> <span class="o">=</span> <span class="n">Float</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For Traits 3.x users</p>
<p>If using Traits 3.x, you need to adapt the namespace of the traits
packages:</p>
<blockquote class="last">
<div><ul class="simple">
<li>traits.api should be enthought.traits.api</li>
<li>traitsui.api should be enthought.traits.ui.api</li>
</ul>
</div></blockquote>
</div>
<p>Using a traits class like that is as simple as any other Python class. Note
that the trait value are passed using keyword arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">reservoir</span> <span class="o">=</span> <span class="n">Reservoir</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Lac de Vouglans&#39;</span><span class="p">,</span> <span class="n">max_storage</span><span class="o">=</span><span class="mi">605</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<div class="section" id="initialisation">
<h3><a class="toc-backref" href="#id4">3.4.3.1. Initialisation</a><a class="headerlink" href="#initialisation" title="Permalink to this headline">¶</a></h3>
<p>All the traits do have a default value that initialise the variables. For
example, the basic python types do have the following trait equivalents:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Trait</th>
<th class="head">Python Type</th>
<th class="head">Built-in Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Bool</td>
<td>Boolean</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>Complex</td>
<td>Complex number</td>
<td>0+0j</td>
</tr>
<tr class="row-even"><td>Float</td>
<td>Floating point number</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>Int</td>
<td>Plain integer</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Long</td>
<td>Long integer</td>
<td>0L</td>
</tr>
<tr class="row-odd"><td>Str</td>
<td>String</td>
<td>‘’</td>
</tr>
<tr class="row-even"><td>Unicode</td>
<td>Unicode</td>
<td>u’‘</td>
</tr>
</tbody>
</table>
<p>A number of other predefined trait type do exist : Array, Enum, Range, Event,
Dict, List, Color, Set, Expression, Code, Callable, Type, Tuple, etc.</p>
<p>Custom default values can be defined in the code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span> <span class="n">Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="k">class</span> <span class="nc">Reservoir</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">name</span> <span class="o">=</span> <span class="n">Str</span>
<div class="newline"></div>    <span class="n">max_storage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">reservoir</span> <span class="o">=</span> <span class="n">Reservoir</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Lac de Vouglans&#39;</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<div class="topic">
<p class="topic-title first"><strong>Complex initialisation</strong></p>
<p>When a complex initialisation is required for a trait, a _XXX_default magic
method can be implemented. It will be lazily called when trying to access
the XXX trait. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_name_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<div class="newline"></div>    <span class="sd">&quot;&quot;&quot; Complex initialisation of the reservoir name. &quot;&quot;&quot;</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="k">return</span> <span class="s1">&#39;Undefined&#39;</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="validation">
<h3><a class="toc-backref" href="#id5">3.4.3.2. Validation</a><a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h3>
<p>Every trait does validation when the user tries to set its content:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">reservoir</span> <span class="o">=</span> <span class="n">Reservoir</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Lac de Vouglans&#39;</span><span class="p">,</span> <span class="n">max_storage</span><span class="o">=</span><span class="mi">605</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">reservoir</span><span class="o">.</span><span class="n">max_storage</span> <span class="o">=</span> <span class="s1">&#39;230&#39;</span>
<div class="newline"></div><span class="o">---------------------------------------------------------------------------</span>
<div class="newline"></div><span class="n">TraitError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<div class="newline"></div><span class="o">.../</span><span class="n">scipy</span><span class="o">-</span><span class="n">lecture</span><span class="o">-</span><span class="n">notes</span><span class="o">/</span><span class="n">advanced</span><span class="o">/</span><span class="n">traits</span><span class="o">/&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">979</span><span class="n">bdff9974a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<div class="newline"></div><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">max_storage</span> <span class="o">=</span> <span class="s1">&#39;230&#39;</span>
<div class="newline"></div>
<div class="newline"></div><span class="o">.../</span><span class="n">traits</span><span class="o">/</span><span class="n">trait_handlers</span><span class="o">.</span><span class="n">pyc</span> <span class="ow">in</span> <span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<div class="newline"></div>    <span class="mi">166</span>         <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    167         raise TraitError( object, name, self.full_info( object, name, value ),</span>
<div class="newline"></div><span class="s2">--&gt; 168                           value )</span>
<div class="newline"></div><span class="s2">    169</span>
<div class="newline"></div><span class="s2">    170     def arg_error ( self, method, arg_num, object, name, value ):</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">TraitError: The &#39;max_storage&#39; trait of a Reservoir instance must be a float, but a value of &#39;23&#39; &lt;type &#39;str&#39;&gt; was specified.</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="documentation">
<h3><a class="toc-backref" href="#id6">3.4.3.3. Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>By essence, all the traits do provide documentation about the model itself. The
declarative approach to the creation of classes makes it self-descriptive:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(100)</span>
<div class="newline"></div></pre></div>
</div>
<p>The <strong>desc</strong> metadata of the traits can be used to provide a more descriptive
information about the trait :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(100, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div></pre></div>
</div>
<p>Let’s now define the complete reservoir class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float, Range</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(1e6, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = Float(10, desc=&#39;Maximal release [m3/s]&#39;)</span>
<div class="newline"></div><span class="s2">    head = Float(10, desc=&#39;Hydraulic head [m]&#39;)</span>
<div class="newline"></div><span class="s2">    efficiency = Range(0, 1.)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def energy_production(self, release):</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39; Returns the energy production [Wh] for the given release [m3/s]</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39;</span>
<div class="newline"></div><span class="s2">        power = 1000 * 9.81 * self.head * release * self.efficiency</span>
<div class="newline"></div><span class="s2">        return power * 3600</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">                        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                        max_storage = 30,</span>
<div class="newline"></div><span class="s2">                        max_release = 100.0,</span>
<div class="newline"></div><span class="s2">                        head = 60,</span>
<div class="newline"></div><span class="s2">                        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    release = 80</span>
<div class="newline"></div><span class="s2">    print &#39;Releasing </span><span class="si">{}</span><span class="s2"> m3/s produces </span><span class="si">{}</span><span class="s2"> kWh&#39;.format(</span>
<div class="newline"></div><span class="s2">                        release, reservoir.energy_production(release)</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="visualization-opening-a-dialog">
<h3><a class="toc-backref" href="#id7">3.4.3.4. Visualization: opening a dialog</a><a class="headerlink" href="#visualization-opening-a-dialog" title="Permalink to this headline">¶</a></h3>
<p>The Traits library is also aware of user interfaces and can pop up a default
view for the Reservoir class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">reservoir1 = Reservoir()</span>
<div class="newline"></div><span class="s2">reservoir1.edit_traits()</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reservoir_default_view.png" class="align-center" src="../../_images/reservoir_default_view.png" />
<p>TraitsUI simplifies the way user interfaces are created. Every trait on a
HasTraits class has a default editor that will manage the way the trait is
rendered to the screen (e.g. the Range trait is displayed as a slider, etc.).</p>
<p>In the very same vein as the Traits declarative way of creating classes,
TraitsUI provides a declarative interface to build user interfaces code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float, Range</span>
<div class="newline"></div><span class="s2">from traitsui.api import View</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(1e6, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = Float(10, desc=&#39;Maximal release [m3/s]&#39;)</span>
<div class="newline"></div><span class="s2">    head = Float(10, desc=&#39;Hydraulic head [m]&#39;)</span>
<div class="newline"></div><span class="s2">    efficiency = Range(0, 1.)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    traits_view = View(</span>
<div class="newline"></div><span class="s2">        &#39;name&#39;, &#39;max_storage&#39;, &#39;max_release&#39;, &#39;head&#39;, &#39;efficiency&#39;,</span>
<div class="newline"></div><span class="s2">        title = &#39;Reservoir&#39;,</span>
<div class="newline"></div><span class="s2">        resizable = True,</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def energy_production(self, release):</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39; Returns the energy production [Wh] for the given release [m3/s]</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39;</span>
<div class="newline"></div><span class="s2">        power = 1000 * 9.81 * self.head * release * self.efficiency </span>
<div class="newline"></div><span class="s2">        return power * 3600</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">                        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                        max_storage = 30,</span>
<div class="newline"></div><span class="s2">                        max_release = 100.0,</span>
<div class="newline"></div><span class="s2">                        head = 60,</span>
<div class="newline"></div><span class="s2">                        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    reservoir.configure_traits()</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reservoir_view.png" class="align-center" src="../../_images/reservoir_view.png" />
</div>
<div class="section" id="deferral">
<h3><a class="toc-backref" href="#id8">3.4.3.5. Deferral</a><a class="headerlink" href="#deferral" title="Permalink to this headline">¶</a></h3>
<p>Being able to defer the definition of a trait and its value to another object
is a powerful feature of Traits.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>    <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="s2">    min_storage = Float</span>
<div class="newline"></div><span class="s2">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    min_release = Float</span>
<div class="newline"></div><span class="s2">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # state attributes</span>
<div class="newline"></div><span class="s2">    storage = Range(low=&#39;min_storage&#39;, high=&#39;max_storage&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # control attributes</span>
<div class="newline"></div><span class="s2">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="s2">    spillage = Float(desc=&#39;Spillage [hm3]&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def print_state(self):</span>
<div class="newline"></div><span class="s2">        print &#39;Storage</span><span class="se">\t</span><span class="s2">Release</span><span class="se">\t</span><span class="s2">Inflows</span><span class="se">\t</span><span class="s2">Spillage&#39;</span>
<div class="newline"></div><span class="s2">        str_format = &#39;</span><span class="se">\t</span><span class="s2">&#39;.join([&#39;</span><span class="si">{:7.2f}</span><span class="s2">&#39;for i in range(4)])</span>
<div class="newline"></div><span class="s2">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="s2">                self.spillage)</span>
<div class="newline"></div><span class="s2">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">            name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">            max_storage = 30,</span>
<div class="newline"></div><span class="s2">            max_release = 100.0,</span>
<div class="newline"></div><span class="s2">            hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">            efficiency = 0.8</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=10)</span>
<div class="newline"></div><span class="s2">    state.release = 90</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;How do we update the current storage ?&#39;</span>
<div class="newline"></div></pre></div>
</div>
<p>A special trait allows to manage events and trigger function calls using the
magic <strong>_xxxx_fired</strong> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range, Event</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">For</span> <span class="n">the</span> <span class="n">simplicity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">example</span><span class="p">,</span> <span class="n">the</span> <span class="n">release</span> <span class="ow">is</span> <span class="n">considered</span> <span class="ow">in</span>
<div class="newline"></div>    <span class="n">hm3</span><span class="o">/</span><span class="n">timestep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m3</span><span class="o">/</span><span class="n">s</span><span class="o">.</span>
<div class="newline"></div>    <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="s2">    min_storage = Float</span>
<div class="newline"></div><span class="s2">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    min_release = Float</span>
<div class="newline"></div><span class="s2">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # state attributes</span>
<div class="newline"></div><span class="s2">    storage = Range(low=&#39;min_storage&#39;, high=&#39;max_storage&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # control attributes</span>
<div class="newline"></div><span class="s2">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="s2">    spillage = Float(desc=&#39;Spillage [hm3]&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    update_storage = Event(desc=&#39;Updates the storage to the next time step&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _update_storage_fired(self):</span>
<div class="newline"></div><span class="s2">        # update storage state</span>
<div class="newline"></div><span class="s2">        new_storage = self.storage - self.release  + self.inflows</span>
<div class="newline"></div><span class="s2">        self.storage = min(new_storage, self.max_storage)</span>
<div class="newline"></div><span class="s2">        overflow = new_storage - self.max_storage</span>
<div class="newline"></div><span class="s2">        self.spillage = max(overflow, 0)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def print_state(self):</span>
<div class="newline"></div><span class="s2">        print &#39;Storage</span><span class="se">\t</span><span class="s2">Release</span><span class="se">\t</span><span class="s2">Inflows</span><span class="se">\t</span><span class="s2">Spillage&#39;</span>
<div class="newline"></div><span class="s2">        str_format = &#39;</span><span class="se">\t</span><span class="s2">&#39;.join([&#39;</span><span class="si">{:7.2f}</span><span class="s2">&#39;for i in range(4)])</span>
<div class="newline"></div><span class="s2">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="s2">                self.spillage)</span>
<div class="newline"></div><span class="s2">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">        max_storage = 30,</span>
<div class="newline"></div><span class="s2">        max_release = 5.0,</span>
<div class="newline"></div><span class="s2">        hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=15)</span>
<div class="newline"></div><span class="s2">    state.release = 5</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # release the maximum amount of water during 3 time steps</span>
<div class="newline"></div><span class="s2">    state.update_storage = True</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div><span class="s2">    state.update_storage = True</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div><span class="s2">    state.update_storage = True</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div></pre></div>
</div>
<p>Dependency between objects can be made automatic using the trait <strong>Property</strong>.
The <strong>depends_on</strong> attribute expresses the dependency between the property and
other traits. When the other traits gets changed, the property is invalidated.
Again, Traits uses magic method names for the property :</p>
<blockquote>
<div><ul class="simple">
<li>_get_XXX for the getter of the XXX Property trait</li>
<li>_set_XXX for the setter of the XXX Property trait</li>
</ul>
</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range</span>
<div class="newline"></div><span class="s2">from traits.api import Property</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">For</span> <span class="n">the</span> <span class="n">simplicity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">example</span><span class="p">,</span> <span class="n">the</span> <span class="n">release</span> <span class="ow">is</span> <span class="n">considered</span> <span class="ow">in</span>
<div class="newline"></div>    <span class="n">hm3</span><span class="o">/</span><span class="n">timestep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m3</span><span class="o">/</span><span class="n">s</span><span class="o">.</span>
<div class="newline"></div>    <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="s2">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    min_release = Float</span>
<div class="newline"></div><span class="s2">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # state attributes</span>
<div class="newline"></div><span class="s2">    storage = Property(depends_on=&#39;inflows, release&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # control attributes</span>
<div class="newline"></div><span class="s2">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="s2">    spillage = Property(</span>
<div class="newline"></div><span class="s2">            desc=&#39;Spillage [hm3]&#39;, depends_on=[&#39;storage&#39;, &#39;inflows&#39;, &#39;release&#39;]</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Private traits.</span>
<div class="newline"></div><span class="s2">    _storage = Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits property implementation.</span>
<div class="newline"></div><span class="s2">    def _get_storage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release + self.inflows</span>
<div class="newline"></div><span class="s2">        return min(new_storage, self.max_storage)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _set_storage(self, storage_value):</span>
<div class="newline"></div><span class="s2">        self._storage = storage_value</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _get_spillage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release  + self.inflows</span>
<div class="newline"></div><span class="s2">        overflow = new_storage - self.max_storage</span>
<div class="newline"></div><span class="s2">        return max(overflow, 0)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def print_state(self):</span>
<div class="newline"></div><span class="s2">        print &#39;Storage</span><span class="se">\t</span><span class="s2">Release</span><span class="se">\t</span><span class="s2">Inflows</span><span class="se">\t</span><span class="s2">Spillage&#39;</span>
<div class="newline"></div><span class="s2">        str_format = &#39;</span><span class="se">\t</span><span class="s2">&#39;.join([&#39;</span><span class="si">{:7.2f}</span><span class="s2">&#39;for i in range(4)])</span>
<div class="newline"></div><span class="s2">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="s2">                self.spillage)</span>
<div class="newline"></div><span class="s2">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">                    name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                    max_storage = 30,</span>
<div class="newline"></div><span class="s2">                    max_release = 5,</span>
<div class="newline"></div><span class="s2">                    hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">                    efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=25)</span>
<div class="newline"></div><span class="s2">    state.release = 4</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Caching property</p>
<p class="last">Heavy computation or long running computation might be a problem when
accessing a property where the inputs have not changed. The
&#64;cached_property decorator can be used to cache the value and only
recompute them once invalidated.</p>
</div>
<p>Let’s extend the TraitsUI introduction with the ReservoirState example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range, Property</span>
<div class="newline"></div><span class="s2">from traitsui.api import View, Item, Group, VGroup</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">For</span> <span class="n">the</span> <span class="n">simplicity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">example</span><span class="p">,</span> <span class="n">the</span> <span class="n">release</span> <span class="ow">is</span> <span class="n">considered</span> <span class="ow">in</span>
<div class="newline"></div>    <span class="n">hm3</span><span class="o">/</span><span class="n">timestep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m3</span><span class="o">/</span><span class="n">s</span><span class="o">.</span>
<div class="newline"></div>    <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="s2">    name = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    min_release = Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # state attributes</span>
<div class="newline"></div><span class="s2">    storage = Property(depends_on=&#39;inflows, release&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # control attributes</span>
<div class="newline"></div><span class="s2">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="s2">    spillage = Property(</span>
<div class="newline"></div><span class="s2">            desc=&#39;Spillage [hm3]&#39;, depends_on=[&#39;storage&#39;, &#39;inflows&#39;, &#39;release&#39;]</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits view</span>
<div class="newline"></div><span class="s2">    traits_view = View(</span>
<div class="newline"></div><span class="s2">        Group(</span>
<div class="newline"></div><span class="s2">            VGroup(Item(&#39;name&#39;), Item(&#39;storage&#39;), Item(&#39;spillage&#39;),</span>
<div class="newline"></div><span class="s2">                label = &#39;State&#39;, style = &#39;readonly&#39;</span>
<div class="newline"></div><span class="s2">            ),</span>
<div class="newline"></div><span class="s2">            VGroup(Item(&#39;inflows&#39;), Item(&#39;release&#39;), label=&#39;Control&#39;),</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Private traits.</span>
<div class="newline"></div><span class="s2">    _storage = Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits property implementation.</span>
<div class="newline"></div><span class="s2">    def _get_storage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release + self.inflows</span>
<div class="newline"></div><span class="s2">        return min(new_storage, self.max_storage)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _set_storage(self, storage_value):</span>
<div class="newline"></div><span class="s2">        self._storage = storage_value</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _get_spillage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release  + self.inflows</span>
<div class="newline"></div><span class="s2">        overflow = new_storage - self.max_storage</span>
<div class="newline"></div><span class="s2">        return max(overflow, 0)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def print_state(self):</span>
<div class="newline"></div><span class="s2">        print &#39;Storage</span><span class="se">\t</span><span class="s2">Release</span><span class="se">\t</span><span class="s2">Inflows</span><span class="se">\t</span><span class="s2">Spillage&#39;</span>
<div class="newline"></div><span class="s2">        str_format = &#39;</span><span class="se">\t</span><span class="s2">&#39;.join([&#39;</span><span class="si">{:7.2f}</span><span class="s2">&#39;for i in range(4)])</span>
<div class="newline"></div><span class="s2">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="s2">                self.spillage)</span>
<div class="newline"></div><span class="s2">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">        max_storage = 30,</span>
<div class="newline"></div><span class="s2">        max_release = 5,</span>
<div class="newline"></div><span class="s2">        hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=25)</span>
<div class="newline"></div><span class="s2">    state.release = 4</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div><span class="s2">    state.configure_traits()</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reservoir_state_view.png" class="align-center" src="../../_images/reservoir_state_view.png" />
<p>Some use cases need the delegation mechanism to be broken by the user when
setting the value of the trait. The <strong>PrototypeFrom</strong> trait implements this
behaviour.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float, Range, PrototypedFrom, Instance</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Turbine(HasTraits):</span>
<div class="newline"></div><span class="s2">    turbine_type = Str</span>
<div class="newline"></div><span class="s2">    power = Float(1.0, desc=&#39;Maximal power delivered by the turbine [Mw]&#39;)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(1e6, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = Float(10, desc=&#39;Maximal release [m3/s]&#39;)</span>
<div class="newline"></div><span class="s2">    head = Float(10, desc=&#39;Hydraulic head [m]&#39;)</span>
<div class="newline"></div><span class="s2">    efficiency = Range(0, 1.)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    turbine = Instance(Turbine)</span>
<div class="newline"></div><span class="s2">    installed_capacity = PrototypedFrom(&#39;turbine&#39;, &#39;power&#39;)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    turbine = Turbine(turbine_type=&#39;type1&#39;, power=5.0)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">            name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">            max_storage = 30,</span>
<div class="newline"></div><span class="s2">            max_release = 100.0,</span>
<div class="newline"></div><span class="s2">            head = 60,</span>
<div class="newline"></div><span class="s2">            efficiency = 0.8,</span>
<div class="newline"></div><span class="s2">            turbine = turbine,</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;installed capacity is initialised with turbine.power&#39;</span>
<div class="newline"></div><span class="s2">    print reservoir.installed_capacity</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;-&#39; * 15</span>
<div class="newline"></div><span class="s2">    print &#39;updating the turbine power updates the installed capacity&#39;</span>
<div class="newline"></div><span class="s2">    turbine.power = 10</span>
<div class="newline"></div><span class="s2">    print reservoir.installed_capacity</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;-&#39; * 15</span>
<div class="newline"></div><span class="s2">    print &#39;setting the installed capacity breaks the link between turbine.power&#39;</span>
<div class="newline"></div><span class="s2">    print &#39;and the installed_capacity trait&#39;</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    reservoir.installed_capacity = 8</span>
<div class="newline"></div><span class="s2">    print turbine.power, reservoir.installed_capacity</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="notification">
<span id="traits-notification"></span><h3><a class="toc-backref" href="#id9">3.4.3.6. Notification</a><a class="headerlink" href="#notification" title="Permalink to this headline">¶</a></h3>
<p>Traits implements a Listener pattern. For each trait a list of static and
dynamic listeners can be fed with callbacks. When the trait does change, all
the listeners are called.</p>
<p>Static listeners are defined using the _XXX_changed magic methods:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>    <span class="sd">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="sd">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="sd">    min_storage = Float</span>
<div class="newline"></div><span class="sd">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="sd">    min_release = Float</span>
<div class="newline"></div><span class="sd">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">    # state attributes</span>
<div class="newline"></div><span class="sd">    storage = Range(low=&#39;min_storage&#39;, high=&#39;max_storage&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">    # control attributes</span>
<div class="newline"></div><span class="sd">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="sd">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="sd">    spillage = Float(desc=&#39;Spillage [hm3]&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">    def print_state(self):</span>
<div class="newline"></div><span class="sd">        print &#39;Storage\tRelease\tInflows\tSpillage&#39;</span>
<div class="newline"></div><span class="sd">        str_format = &#39;\t&#39;.join([&#39;{:7.2f}&#39;for i in range(4)])</span>
<div class="newline"></div><span class="sd">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="sd">                self.spillage)</span>
<div class="newline"></div><span class="sd">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div><span class="sd">    ### Traits listeners ###########</span>
<div class="newline"></div><span class="sd">    def _release_changed(self, new):</span>
<div class="newline"></div><span class="sd">        &quot;&quot;&quot;</span><span class="n">When</span> <span class="n">the</span> <span class="n">release</span> <span class="ow">is</span> <span class="n">higher</span> <span class="n">than</span> <span class="n">zero</span><span class="p">,</span> <span class="n">warn</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">inhabitants</span> <span class="n">of</span>
<div class="newline"></div>        <span class="n">the</span> <span class="n">valley</span><span class="o">.</span>
<div class="newline"></div>        <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">        if new &gt; 0:</span>
<div class="newline"></div><span class="s2">            print &#39;Warning, we are releasing </span><span class="si">{}</span><span class="s2"> hm3 of water&#39;.format(new)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">            name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">            max_storage = 30,</span>
<div class="newline"></div><span class="s2">            max_release = 100.0,</span>
<div class="newline"></div><span class="s2">            hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">            efficiency = 0.8</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=10)</span>
<div class="newline"></div><span class="s2">    state.release = 90</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div></pre></div>
</div>
<p>The static trait notification signatures can be:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>def _release_changed(self):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def _release_changed(self, new):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def _release_changed(self, old, new):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def _release_changed(self, name, old, new</dt>
<dd>pass</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="topic">
<p class="topic-title first"><strong>Listening to all the changes</strong></p>
<p>To listen to all the changes on a HasTraits class, the magic
<strong>_any_trait_changed</strong> method can be implemented.</p>
</div>
<p>In many situations, you do not know in advance what type of listeners need to
be activated. Traits offers the ability to register listeners on the fly with
the dynamic listeners</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div><span class="s2">from reservoir_state_property import ReservoirState</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">def wake_up_watchman_if_spillage(new_value):</span>
<div class="newline"></div><span class="s2">    if new_value &gt; 0:</span>
<div class="newline"></div><span class="s2">        print &#39;Wake up watchman! Spilling </span><span class="si">{}</span><span class="s2"> hm3&#39;.format(new_value)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">                        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                        max_storage = 30,</span>
<div class="newline"></div><span class="s2">                        max_release = 100.0,</span>
<div class="newline"></div><span class="s2">                        hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">                        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=10)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    #register the dynamic listener</span>
<div class="newline"></div><span class="s2">    state.on_trait_change(wake_up_watchman_if_spillage, name=&#39;spillage&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state.release = 90</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div><span class="s2">    state.print_state()</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;Forcing spillage&#39;</span>
<div class="newline"></div><span class="s2">    state.inflows = 100</span>
<div class="newline"></div><span class="s2">    state.release = 0</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    print &#39;Why do we have two executions of the callback ?&#39;</span>
<div class="newline"></div></pre></div>
</div>
<p>The dynamic trait notification signatures are not the same as the static ones :</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>def wake_up_watchman():</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def wake_up_watchman(new):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def wake_up_watchman(name, new):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def wake_up_watchman(object, name, new):</dt>
<dd>pass</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>def wake_up_watchman(object, name, old, new):</dt>
<dd>pass</dd>
</dl>
</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Removing a dynamic listener can be done by:</dt>
<dd><ul class="first last simple">
<li>calling the remove_trait_listener method on the trait with the listener
method as argument,</li>
<li>calling the on_trait_change method with listener method and the keyword
remove=True,</li>
<li>deleting the instance that holds the listener.</li>
</ul>
</dd>
</dl>
<p>Listeners can also be added to classes using the <strong>on_trait_change</strong> decorator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance, DelegatesTo, Float, Range</span>
<div class="newline"></div><span class="s2">from traits.api import Property, on_trait_change</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirState(HasTraits):</span>
<div class="newline"></div><span class="s2">    &quot;&quot;&quot;</span><span class="n">Keeps</span> <span class="n">track</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reservoir</span> <span class="n">state</span> <span class="n">given</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">storage</span><span class="o">.</span>
<div class="newline"></div>
<div class="newline"></div>    <span class="n">For</span> <span class="n">the</span> <span class="n">simplicity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">example</span><span class="p">,</span> <span class="n">the</span> <span class="n">release</span> <span class="ow">is</span> <span class="n">considered</span> <span class="ow">in</span>
<div class="newline"></div>    <span class="n">hm3</span><span class="o">/</span><span class="n">timestep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m3</span><span class="o">/</span><span class="n">s</span><span class="o">.</span>
<div class="newline"></div>    <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir, ())</span>
<div class="newline"></div><span class="s2">    max_storage = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div><span class="s2">    min_release = Float</span>
<div class="newline"></div><span class="s2">    max_release = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # state attributes</span>
<div class="newline"></div><span class="s2">    storage = Property(depends_on=&#39;inflows, release&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    # control attributes</span>
<div class="newline"></div><span class="s2">    inflows =  Float(desc=&#39;Inflows [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    release = Range(low=&#39;min_release&#39;, high=&#39;max_release&#39;)</span>
<div class="newline"></div><span class="s2">    spillage = Property(</span>
<div class="newline"></div><span class="s2">            desc=&#39;Spillage [hm3]&#39;, depends_on=[&#39;storage&#39;, &#39;inflows&#39;, &#39;release&#39;]</span>
<div class="newline"></div><span class="s2">        )</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Private traits. ##########</span>
<div class="newline"></div><span class="s2">    _storage = Float</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits property implementation.</span>
<div class="newline"></div><span class="s2">    def _get_storage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release + self.inflows</span>
<div class="newline"></div><span class="s2">        return min(new_storage, self.max_storage)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _set_storage(self, storage_value):</span>
<div class="newline"></div><span class="s2">        self._storage = storage_value</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _get_spillage(self):</span>
<div class="newline"></div><span class="s2">        new_storage = self._storage - self.release  + self.inflows</span>
<div class="newline"></div><span class="s2">        overflow = new_storage - self.max_storage</span>
<div class="newline"></div><span class="s2">        return max(overflow, 0)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    @on_trait_change(&#39;storage&#39;)</span>
<div class="newline"></div><span class="s2">    def print_state(self):</span>
<div class="newline"></div><span class="s2">        print &#39;Storage</span><span class="se">\t</span><span class="s2">Release</span><span class="se">\t</span><span class="s2">Inflows</span><span class="se">\t</span><span class="s2">Spillage&#39;</span>
<div class="newline"></div><span class="s2">        str_format = &#39;</span><span class="se">\t</span><span class="s2">&#39;.join([&#39;</span><span class="si">{:7.2f}</span><span class="s2">&#39;for i in range(4)])</span>
<div class="newline"></div><span class="s2">        print str_format.format(self.storage, self.release, self.inflows,</span>
<div class="newline"></div><span class="s2">                self.spillage)</span>
<div class="newline"></div><span class="s2">        print &#39;-&#39; * 79</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    projectA = Reservoir(</span>
<div class="newline"></div><span class="s2">                        name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                        max_storage = 30,</span>
<div class="newline"></div><span class="s2">                        max_release = 5,</span>
<div class="newline"></div><span class="s2">                        hydraulic_head = 60,</span>
<div class="newline"></div><span class="s2">                        efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    state = ReservoirState(reservoir=projectA, storage=25)</span>
<div class="newline"></div><span class="s2">    state.release = 4</span>
<div class="newline"></div><span class="s2">    state.inflows = 0</span>
<div class="newline"></div></pre></div>
</div>
<p>The patterns supported by the on_trait_change method and decorator are
powerful. The reader should look at the docstring of HasTraits.on_trait_change
for the details.</p>
</div>
<div class="section" id="some-more-advanced-traits">
<h3><a class="toc-backref" href="#id10">3.4.3.7. Some more advanced traits</a><a class="headerlink" href="#some-more-advanced-traits" title="Permalink to this headline">¶</a></h3>
<p>The following example demonstrate the usage of the Enum and List traits :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float, Range, Enum, List</span>
<div class="newline"></div><span class="s2">from traitsui.api import View, Item</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class IrrigationArea(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    surface = Float(desc=&#39;Surface [ha]&#39;)</span>
<div class="newline"></div><span class="s2">    crop = Enum(&#39;Alfalfa&#39;, &#39;Wheat&#39;, &#39;Cotton&#39;)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(1e6, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = Float(10, desc=&#39;Maximal release [m3/s]&#39;)</span>
<div class="newline"></div><span class="s2">    head = Float(10, desc=&#39;Hydraulic head [m]&#39;)</span>
<div class="newline"></div><span class="s2">    efficiency = Range(0, 1.)</span>
<div class="newline"></div><span class="s2">    irrigated_areas = List(IrrigationArea)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def energy_production(self, release):</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39; Returns the energy production [Wh] for the given release [m3/s]</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39;</span>
<div class="newline"></div><span class="s2">        power = 1000 * 9.81 * self.head * release * self.efficiency</span>
<div class="newline"></div><span class="s2">        return power * 3600</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    traits_view = View(</span>
<div class="newline"></div><span class="s2">        Item(&#39;name&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;max_storage&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;max_release&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;head&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;efficiency&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;irrigated_areas&#39;),</span>
<div class="newline"></div><span class="s2">        resizable = True</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    upper_block = IrrigationArea(name=&#39;Section C&#39;, surface=2000, crop=&#39;Wheat&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">                    name=&#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                    max_storage=30,</span>
<div class="newline"></div><span class="s2">                    max_release=100.0,</span>
<div class="newline"></div><span class="s2">                    head=60,</span>
<div class="newline"></div><span class="s2">                    efficiency=0.8,</span>
<div class="newline"></div><span class="s2">                    irrigated_areas=[upper_block]</span>
<div class="newline"></div><span class="s2">                )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    release = 80</span>
<div class="newline"></div><span class="s2">    print &#39;Releasing </span><span class="si">{}</span><span class="s2"> m3/s produces </span><span class="si">{}</span><span class="s2"> kWh&#39;.format(</span>
<div class="newline"></div><span class="s2">        release, reservoir.energy_production(release)</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div></pre></div>
</div>
<p>Trait listeners can be used to listen to changes in the content of the list to
e.g. keep track of the total crop surface on linked to a given reservoir.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Str, Float, Range, Enum, List, Property</span>
<div class="newline"></div><span class="s2">from traitsui.api import View, Item</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class IrrigationArea(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    surface = Float(desc=&#39;Surface [ha]&#39;)</span>
<div class="newline"></div><span class="s2">    crop = Enum(&#39;Alfalfa&#39;, &#39;Wheat&#39;, &#39;Cotton&#39;)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class Reservoir(HasTraits):</span>
<div class="newline"></div><span class="s2">    name = Str</span>
<div class="newline"></div><span class="s2">    max_storage = Float(1e6, desc=&#39;Maximal storage [hm3]&#39;)</span>
<div class="newline"></div><span class="s2">    max_release = Float(10, desc=&#39;Maximal release [m3/s]&#39;)</span>
<div class="newline"></div><span class="s2">    head = Float(10, desc=&#39;Hydraulic head [m]&#39;)</span>
<div class="newline"></div><span class="s2">    efficiency = Range(0, 1.)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    irrigated_areas = List(IrrigationArea)</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    total_crop_surface = Property(depends_on=&#39;irrigated_areas.surface&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _get_total_crop_surface(self):</span>
<div class="newline"></div><span class="s2">        return sum([iarea.surface for iarea in self.irrigated_areas])</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def energy_production(self, release):</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39; Returns the energy production [Wh] for the given release [m3/s]</span>
<div class="newline"></div><span class="s2">        &#39;&#39;&#39;</span>
<div class="newline"></div><span class="s2">        power = 1000 * 9.81 * self.head * release * self.efficiency </span>
<div class="newline"></div><span class="s2">        return power * 3600</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    traits_view = View(</span>
<div class="newline"></div><span class="s2">        Item(&#39;name&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;max_storage&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;max_release&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;head&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;efficiency&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;irrigated_areas&#39;),</span>
<div class="newline"></div><span class="s2">        Item(&#39;total_crop_surface&#39;),</span>
<div class="newline"></div><span class="s2">        resizable = True</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    upper_block = IrrigationArea(name=&#39;Section C&#39;, surface=2000, crop=&#39;Wheat&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">                        name=&#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                        max_storage=30,</span>
<div class="newline"></div><span class="s2">                        max_release=100.0,</span>
<div class="newline"></div><span class="s2">                        head=60,</span>
<div class="newline"></div><span class="s2">                        efficiency=0.8,</span>
<div class="newline"></div><span class="s2">                        irrigated_areas=[upper_block],</span>
<div class="newline"></div><span class="s2">                    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    release = 80</span>
<div class="newline"></div><span class="s2">    print &#39;Releasing </span><span class="si">{}</span><span class="s2"> m3/s produces </span><span class="si">{}</span><span class="s2"> kWh&#39;.format(</span>
<div class="newline"></div><span class="s2">        release, reservoir.energy_production(release)</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div></pre></div>
</div>
<p>The next example shows how the Array trait can be used to feed a specialised
TraitsUI Item, the ChacoPlotItem:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">import numpy as np</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from traits.api import HasTraits, Array, Instance, Float, Property</span>
<div class="newline"></div><span class="s2">from traits.api import DelegatesTo</span>
<div class="newline"></div><span class="s2">from traitsui.api import View, Item, Group</span>
<div class="newline"></div><span class="s2">from chaco.chaco_plot_editor import ChacoPlotItem</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">from reservoir import Reservoir</span>
<div class="newline"></div>
<div class="newline"></div>
<div class="newline"></div><span class="s2">class ReservoirEvolution(HasTraits):</span>
<div class="newline"></div><span class="s2">    reservoir = Instance(Reservoir)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    name = DelegatesTo(&#39;reservoir&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    inflows = Array(dtype=np.float64, shape=(None))</span>
<div class="newline"></div><span class="s2">    releass = Array(dtype=np.float64, shape=(None))</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    initial_stock = Float</span>
<div class="newline"></div><span class="s2">    stock = Property(depends_on=&#39;inflows, releases, initial_stock&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    month = Property(depends_on=&#39;stock&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits view ###########</span>
<div class="newline"></div><span class="s2">    traits_view = View(</span>
<div class="newline"></div><span class="s2">        Item(&#39;name&#39;),</span>
<div class="newline"></div><span class="s2">        Group(</span>
<div class="newline"></div><span class="s2">            ChacoPlotItem(&#39;month&#39;, &#39;stock&#39;, show_label=False),</span>
<div class="newline"></div><span class="s2">        ),</span>
<div class="newline"></div><span class="s2">        width = 500,</span>
<div class="newline"></div><span class="s2">        resizable = True</span>
<div class="newline"></div><span class="s2">    )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    ### Traits properties #####</span>
<div class="newline"></div><span class="s2">    def _get_stock(self):</span>
<div class="newline"></div><span class="s2">        &quot;&quot;&quot;</span>
<div class="newline"></div>        <span class="n">fixme</span><span class="p">:</span> <span class="n">should</span> <span class="n">handle</span> <span class="n">cases</span> <span class="n">where</span> <span class="n">we</span> <span class="n">go</span> <span class="n">over</span> <span class="n">the</span> <span class="nb">max</span> <span class="n">storage</span>
<div class="newline"></div>        <span class="s2">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="s2">        return  self.initial_stock + (self.inflows - self.releases).cumsum()</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    def _get_month(self):</span>
<div class="newline"></div><span class="s2">        return np.arange(self.stock.size)</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">if __name__ == &#39;__main__&#39;:</span>
<div class="newline"></div><span class="s2">    reservoir = Reservoir(</span>
<div class="newline"></div><span class="s2">                            name = &#39;Project A&#39;,</span>
<div class="newline"></div><span class="s2">                            max_storage = 30,</span>
<div class="newline"></div><span class="s2">                            max_release = 100.0,</span>
<div class="newline"></div><span class="s2">                            head = 60,</span>
<div class="newline"></div><span class="s2">                            efficiency = 0.8</span>
<div class="newline"></div><span class="s2">                        )</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    initial_stock = 10.</span>
<div class="newline"></div><span class="s2">    inflows_ts = np.array([6., 6, 4, 4, 1, 2, 0, 0, 3, 1, 5, 3])</span>
<div class="newline"></div><span class="s2">    releases_ts = np.array([4., 5, 3, 5, 3, 5, 5, 3, 2, 1, 3, 3])</span>
<div class="newline"></div>
<div class="newline"></div><span class="s2">    view = ReservoirEvolution(</span>
<div class="newline"></div><span class="s2">                                reservoir = reservoir,</span>
<div class="newline"></div><span class="s2">                                inflows = inflows_ts,</span>
<div class="newline"></div><span class="s2">                                releases = releases_ts</span>
<div class="newline"></div><span class="s2">                            )</span>
<div class="newline"></div><span class="s2">    view.configure_traits()</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reservoir_evolution.png" class="align-center" src="../../_images/reservoir_evolution.png" />
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>References</p>
<ul class="last simple">
<li><a class="reference external" href="https://github.com/enthought">ETS repositories</a></li>
<li><a class="reference external" href="http://docs.enthought.com/traits/traits_user_manual/index.html">Traits manual</a></li>
<li><a class="reference external" href="http://docs.enthought.com/traitsui/traitsui_user_manual/index.html">Traits UI manual</a></li>
<li>Mailing list : <a class="reference external" href="mailto:enthought-dev&#37;&#52;&#48;enthought&#46;com">enthought-dev<span>&#64;</span>enthought<span>&#46;</span>com</a></li>
</ul>
</div>
<p><div style="clear: both"></div></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
	<div class="sidebartoc">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.4. Traits: building interactive dialogs</a><ul>
<li><a class="reference internal" href="#introduction">3.4.1. Introduction</a></li>
<li><a class="reference internal" href="#example">3.4.2. Example</a></li>
<li><a class="reference internal" href="#what-are-traits">3.4.3. What are Traits</a><ul>
<li><a class="reference internal" href="#initialisation">3.4.3.1. Initialisation</a></li>
<li><a class="reference internal" href="#validation">3.4.3.2. Validation</a></li>
<li><a class="reference internal" href="#documentation">3.4.3.3. Documentation</a></li>
<li><a class="reference internal" href="#visualization-opening-a-dialog">3.4.3.4. Visualization: opening a dialog</a></li>
<li><a class="reference internal" href="#deferral">3.4.3.5. Deferral</a></li>
<li><a class="reference internal" href="#notification">3.4.3.6. Notification</a></li>
<li><a class="reference internal" href="#some-more-advanced-traits">3.4.3.7. Some more advanced traits</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>



    <div class="script_container">
    <script>
    (function() {
	var cx = '004523248466141510607:hgv2yimrahw';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	    '//cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search></gcse:search>
    </div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../3d_plotting/index.html" title="3.5. 3D plotting with Mayavi"
             >next</a></li>
        <li class="right" >
          <a href="../scikit-image/auto_examples/plot_segmentations.html" title="3.3.9.11. Watershed and random walker for segmentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >3. Packages and applications</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/scipy-lectures/scipy-lecture-notes/edit/master/packages/traits/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Edit it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012,2013,2015,2016,2017,2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>